# ============================================
# Default Apache Virtual Host Configuration
# ============================================

# Global ServerName to suppress AH00558 warning
ServerName localhost

# Pass environment variables to PHP (non-sensitive only)
# Note: Sensitive data like passwords should be read from 
# environment inside the container, not via Apache PassEnv
PassEnv APP_ENV
PassEnv DB_HOST
PassEnv REDIS_HOST

# RemoteIP Configuration (Trust Docker network)
RemoteIPHeader X-Forwarded-For
RemoteIPInternalProxy 172.16.0.0/12
RemoteIPInternalProxy 192.168.0.0/16
RemoteIPInternalProxy 10.0.0.0/8

# Improved Server Variables (Proxy Compatibility)
SetEnvIf X-Forwarded-Proto "https" HTTPS=on
SetEnvIf X-Forwarded-Proto "https" REQUEST_SCHEME=https
SetEnvIf X-Forwarded-Port "^(.+)$" SERVER_PORT=$1

<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot ${APACHE_DOCUMENT_ROOT}
    ServerName localhost
    ServerAlias www.localhost webserver

    Include /etc/apache2/sites-enabled/partials/default-common.inc

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

# HTTPS Virtual Host
<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    DocumentRoot ${APACHE_DOCUMENT_ROOT}
    ServerName localhost
    ServerAlias www.localhost

    Include /etc/apache2/sites-enabled/partials/default-common.inc

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl-sites/cert.pem
    SSLCertificateKeyFile /etc/apache2/ssl-sites/cert-key.pem

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined
</VirtualHost>
